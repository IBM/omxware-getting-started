CACHE TABLE IPR_STAGING;

DROP TABLE IF EXISTS IPR;

CREATE TABLE IPR
  USING PARQUET
  AS
  SELECT
    IPR_ACCESSION,
    TYPE,
    NAME,
    DESCRIPTION
    FROM
      IPR_STAGING;

CACHE TABLE IPR;

SELECT
  IPR_ACCESSION,
  COUNT(IPR_ACCESSION) AS DUPLICATE_COUNT
  FROM
    IPR
    GROUP BY
      IPR_ACCESSION
    HAVING
      COUNT(IPR_ACCESSION) > 1;

SELECT
  COUNT(1) AS NUM_ROWS,
  COUNT(DISTINCT IPR_ACCESSION) AS NUM_DISTINCT_IPRS,
  COUNT(DISTINCT TYPE) AS NUM_DISTINCT_TYPES
  FROM
    IPR;

SELECT *
  FROM
    IPR
    ORDER BY 1
    LIMIT 10;

DROP TABLE IPR_STAGING;
